library(readxl)
library(ggplot2)
library(dplyr)
# Read data.
data <- read_excel("C:/Users/piken/Desktop/Resiliencia/resilience_histograms.xlsx")
data_pri<-read_excel("C:/Users/piken/Desktop/Resiliencia/histogramas_relatorio.xlsx")
# Convert the "Resiliencia" column to a factor.
data_pri$Resiliencia <- as.factor(data_pri$Resiliencia)
data_pri$ordem<-as.factor(data_pri$ordem)
data_pri$quadrante<-as.factor(data_pri$quadrante)
# Create a custom color palette with RGB values
custom_palette <- data_pri %>% 
  group_by(Resiliencia) %>% 
  summarize(R = first(R), G = first(G), B = first(B)) %>%
  mutate(
    RGB = grDevices::rgb(R / 255, G / 255, B / 255)
  ) %>% 
  pull(RGB)

# Iterate through the columns and create separate histograms with the custom color palette.
for (col_name in colnames(data)) {
  if (col_name != "Resiliencia") {
    p <- ggplot(data, aes(x = Resiliencia, y = .data[[col_name]])) +
      geom_bar(stat = "identity", aes(fill = Resiliencia)) +
      scale_fill_manual(values = custom_palette) +
      labs(title = paste("Histogram of", col_name),
           x = "Resiliencia",
           y = col_name) +
      theme_minimal() +
      theme(legend.position = "top")
    
    plot(p)
  }
}

ggplot(data_pri, aes(x = ordem, y = Brasil)) +
  geom_bar(stat = "identity", aes(fill = Resiliencia),
           width = 0.4) +
  scale_fill_manual(values = custom_palette) +
  labs(title = paste("Histogram of", "Brasil"),
       x = "Resiliência",
       y = "% de Pixels") +
  theme_classic() +
  theme(legend.position = "top") + 
  scale_x_discrete(labels=c(data_pri$Resiliencia))


r_brasil<-ggplot(data_pri, aes(x = Resiliencia, y = Brasil)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Brasil,digits = 1)), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Brasil",
       x = "Resiliência",
       y = "% de Pixels", 
       fill= "Resiliência") +
  theme_classic() +
  theme(         panel.background = element_rect(fill='transparent'),
                 plot.background = element_rect(fill='transparent', color=NA),
                 panel.grid.major = element_blank(),
                 panel.grid.minor = element_blank(),
                 legend.background = element_rect(fill='transparent'),
                 legend.box.background = element_rect(fill='transparent'),
                 legend.position = "bottom", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

r_brasil

###### Amazonia
amz<-ggplot(data_pri, aes(x = Resiliencia, y = Amazonia)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Amazonia,digits = 1)), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Amazônia",
       x = "Classe de resiliência",
       y = "Pixels (% do Bioma)",
       fill= "Resiliência") +
  theme_classic() +
  theme(panel.background = element_rect(fill='transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_rect(fill='transparent'),
        legend.box.background = element_rect(fill='transparent'),
    
        legend.position = "none", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

amz

###### Mata Atlântica
mat<-ggplot(data_pri, aes(x = Resiliencia, y = Mata_Atlantica)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Mata_Atlantica,digits = 1)), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Mata Atlântica",
       x = "Classe de resiliência",
       y = "Pixels (% do Bioma)",
       fill= "Resiliência") +
  theme_classic() +
  theme(panel.background = element_rect(fill='transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_rect(fill='transparent'),
        legend.box.background = element_rect(fill='transparent'),
        legend.position = "none", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

mat

###### Cerrado
cer<-ggplot(data_pri, aes(x = Resiliencia, y = Cerrado)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Cerrado,digits = 1)), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Cerrado",
       x = "Classe de resiliência",
       y = "Pixels (% do Bioma)",
       fill= "Resiliência") +
  theme_classic() +
  theme(panel.background = element_rect(fill='transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_rect(fill='transparent'),
        legend.box.background = element_rect(fill='transparent'),
        legend.position = "none", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

cer

###### Caatinga
caa<-ggplot(data_pri, aes(x = Resiliencia, y = Caatinga)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Caatinga,digits = 1)), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Caatinga",
       x = "Classe de resiliência",
       y = "Pixels (% do Bioma)", 
       fill= "Resiliência") +
  theme_classic() +
  theme(panel.background = element_rect(fill='transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_rect(fill='transparent'),
        legend.box.background = element_rect(fill='transparent'),
        legend.position = "none", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

caa

###### Pantanal
pant<-ggplot(data_pri, aes(x = Resiliencia, y = Pantanal)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Pantanal,digits = 1)), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Pantanal",
       x = "Classe de resiliência",
       y = "Pixels (% do Bioma)",
       fill= "Resiliência") +
  theme_classic() +
  theme(panel.background = element_rect(fill='transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_rect(fill='transparent'),
        legend.box.background = element_rect(fill='transparent'),
        legend.position = "none", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

pant

###### Pampa
pamp<-ggplot(data_pri, aes(x = Resiliencia, y = Pampa)) +
  geom_bar(stat='identity', colour="black", aes(fill = Resiliencia),
           width = 0.6, position = position_dodge(.7)) +
  geom_text(aes(label=round(Pampa,digits = 1 )), vjust=-0.5, size= 3.5) +
  scale_fill_manual(values = custom_palette) +
  labs(title = "Pampa",
       x = "Classe de resiliência",
       y = "Pixels (% do Bioma)",
       fill= "Resiliência") +
  theme_classic() +
  theme(panel.background = element_rect(fill='transparent'),
        plot.background = element_rect(fill='transparent', color=NA),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.background = element_rect(fill='transparent'),
        legend.box.background = element_rect(fill='transparent'),
        legend.position = "none", 
        legend.spacing.x = unit(0.2, 'cm'),
        legend.spacing.y = unit(0.1, "cm"),
        axis.title.x = element_text(vjust = -0.75),
        #strip.background = element_blank(),
        #strip.text.x = element_blank()
        ) +
  guides(fill = guide_legend(byrow = TRUE))+
  facet_wrap(.~ quadrante, nrow = 1, scales = "free_x")

pamp

library(ggpubr)


prancha_plots<-ggarrange(
  r_brasil,                # First row with line plot
  # Second row with box and dot plots
  ggarrange(amz, caa, cer, mat, pamp, pant, ncol = 2, nrow=3, labels = c("B", "C", "D", "E", "F", "G")), 
  nrow = 2, heights = c(1,3), widths = 5,
  labels = "A", common.legend = TRUE, legend = "bottom"       # Label of the line plot
) 

ggsave("final_plot_2024.png", prancha_plots, bg= 'transparent', width = 30, height = 50, units = "cm")

